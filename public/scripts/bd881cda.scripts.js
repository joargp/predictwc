"use strict";angular.module("predictwcApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/groups",{templateUrl:"views/groups.html",controller:"GroupsCtrl"}).when("/countries",{templateUrl:"views/countries.html",controller:"CountriesCtrl"}).when("/matches",{templateUrl:"views/matches.html",controller:"MatchesCtrl"}).when("/bets",{templateUrl:"views/bets.html",controller:"BetsCtrl"}).when("/winners",{templateUrl:"views/winners.html",controller:"WinnersCtrl"}).when("/matchesAdmin",{templateUrl:"views/matchesadmin.html",controller:"MatchesadminCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("predictwcApp").controller("MainCtrl",["$scope","$http","countries",function(a,b,c){c.getAll().then(function(b){a.countries=b})}]),angular.module("predictwcApp").controller("ProfileCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("predictwcApp").controller("GroupsCtrl",["$scope","groups",function(a,b){b.getAll().then(function(b){a.groups=b})}]),angular.module("predictwcApp").controller("LoginCtrl",["$scope","$location",function(a,b){a.loggedInUser=void 0,dpd.users.me(function(b){a.loggedInUser=b,console.log(b)}),a.createUser=function(a,b){dpd.users.post({username:a,password:b},function(a,b){return b?console.log(b):void console.log(a)})},a.loginUser=function(c,d){dpd.users.login({username:c,password:d},function(b,c){return c?console.log(c):(console.log(b),void(a.loggedInUser=b))}),b.path("bets")}}]),angular.module("predictwcApp").factory("countries",["$q",function(a){return{getAll:function(){var b=a.defer();return dpd.countries.get({$sort:{name:1}},function(a){b.resolve(a)}),b.promise},add:function(b){var c=a.defer();return dpd.countries.post({name:b.name,groupId:b.groupId,flagCode:b.flagCode},function(a){c.resolve(a)}),c.promise}}}]),angular.module("predictwcApp").factory("groups",["$q",function(a){return{getAll:function(){var b=a.defer();return dpd.groups.get(function(a){b.resolve(a)}),b.promise}}}]),angular.module("predictwcApp").directive("flag",function(){return{templateUrl:"/views/directives/flag.html",restrict:"E"}}),angular.module("predictwcApp").directive("flagIcon",function(){return{templateUrl:"/views/directives/flag-icon.html",restrict:"E"}}),angular.module("predictwcApp").controller("CountriesCtrl",["$scope","countries","groups",function(a,b,c){b.getAll().then(function(b){a.countries=b}),c.getAll().then(function(b){a.groups=b}),a.country={name:"",groupId:"",flagCode:""},a.addCountry=function(c){b.add(c).then(function(b){a.countries.unshift(b)})}}]),angular.module("predictwcApp").controller("MatchesCtrl",["$scope","matches","countries","isLoading",function(a,b,c,d){d.set(!0),c.getAll().then(function(b){a.countries=b}),b.getAll().then(function(b){a.matches=b,d.set(!1)}),a.match={homeTeam:"",awayTeam:"",time:"",date:""},a.addMatch=function(c){c.startTime=new Date(c.date+" "+c.time).getTime(),b.add(c).then(function(b){a.matches.unshift(b)})}}]),angular.module("predictwcApp").factory("matches",["$q",function(a){return{getAll:function(){var b=a.defer();return dpd.matches.get({$sort:{startTime:1}},function(a){b.resolve(a)}),b.promise},add:function(b){var c=a.defer();return dpd.matches.post({awayTeamId:b.awayTeamId,homeTeamId:b.homeTeamId,startTime:b.startTime},function(a){c.resolve(a)}),c.promise},update:function(b){var c=a.defer();return dpd.matches.put(b.id,{homeScore:b.homeScore,awayScore:b.awayScore},function(a){c.resolve(a)}),c.promise}}}]),angular.module("predictwcApp").controller("BetsCtrl",["$scope","matches","bets","users","dpd","_","isLoading",function(a,b,c,d,e,f,g){g.set(!0),b.getAll().then(function(b){c.getAll().then(function(c){d.getAll().then(function(d){c=f.forEach(c,function(e){e.username=f.find(d,{id:e.userId}).username,a.matches=f.forEach(b,function(a){a.bets=f.where(c,{matchId:a.id})}),g.set(!1)})})})}),a.addBet=function(a){a.locked=!0,c.add(a).then(function(){})}}]),angular.module("predictwcApp").factory("bets",["$q",function(a){return{getAll:function(){var b=a.defer();return dpd.bets.get(function(a){b.resolve(a)}),b.promise},add:function(b){var c=a.defer();return console.log(b),dpd.bets.post({homeScore:b.chosenHomeScore,awayScore:b.chosenAwayScore,matchId:b.id},function(a,b){return b?console.log(b):void c.resolve(a)}),c.promise}}}]),angular.module("predictwcApp").controller("WinnersCtrl",["$scope","countries",function(a,b){b.getAll().then(function(b){a.countries=b}),dpd.users.me(function(b){a.me=b}),a.save=function(b,c,d,e){a.me&&dpd.users.put(a.me.id,{winner:b,second:c,third:d,topScorer:e},function(a,b){return b?console.log(b):void console.log(a,a.id)})}}]),angular.module("predictwcApp").constant("dpd",dpd),angular.module("predictwcApp").constant("_",_),angular.module("predictwcApp").factory("users",["$q","dpd",function(a,b){return{getAll:function(){var c=a.defer();return b.users.get(function(a){c.resolve(a)}),c.promise}}}]),angular.module("predictwcApp").controller("MatchesadminCtrl",["$scope","matches","countries",function(a,b,c){c.getAll().then(function(b){a.countries=b}),b.getAll().then(function(b){a.matches=b}),a.match={homeTeam:"",awayTeam:"",time:"",date:""},a.updateMatch=function(){b.add(match).then(function(b){a.matches.unshift(b)})}}]),angular.module("predictwcApp").directive("loading",["$http","isLoading",function(a,b){return{restrict:"A",link:function(c,d){c.isLoading=function(){return b.status()||a.pendingRequests.length>0},c.$watch(c.isLoading,function(a){a?d.show():d.hide()})}}}]),angular.module("predictwcApp").factory("isLoading",function(){var a=!1;return{status:function(){return a},set:function(b){a=b}}});